<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Dashboard - Fingerprint Matching System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header p {
            color: #666;
            font-size: 1.2em;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .test-title {
            font-size: 1.2em;
            color: #333;
            font-weight: 600;
        }

        .test-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .status-pass {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .status-fail {
            background: #ffcdd2;
            color: #c62828;
        }

        .status-partial {
            background: #fff9c4;
            color: #f57f17;
        }

        .test-details {
            margin: 15px 0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .detail-label {
            color: #666;
            font-weight: 500;
        }

        .detail-value {
            color: #333;
            font-weight: 600;
        }

        .similarity-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
        }

        .similarity-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .threshold-markers {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            pointer-events: none;
        }

        .threshold-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(0, 0, 0, 0.3);
        }

        .summary-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-stat {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-weight: 500;
        }

        .matrix-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .matrix-table th,
        .matrix-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .matrix-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .matrix-cell {
            font-weight: 600;
            padding: 8px;
            border-radius: 8px;
        }

        .match-high {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .match-medium {
            background: #fff9c4;
            color: #f57f17;
        }

        .match-low {
            background: #ffe0b2;
            color: #ef6c00;
        }

        .match-none {
            background: #ffcdd2;
            color: #c62828;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .controls {
            text-align: center;
            margin: 30px 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .test-card {
            animation: fadeIn 0.5s ease forwards;
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Test Dashboard</h1>
            <p>Sistema de Valida√ß√£o do Matching Inteligente</p>
        </div>

        <div class="summary-section">
            <h2>üìä Resumo dos Testes</h2>
            <div class="summary-grid">
                <div class="summary-stat">
                    <div class="stat-value" id="total-tests">0</div>
                    <div class="stat-label">Total de Testes</div>
                </div>
                <div class="summary-stat">
                    <div class="stat-value" id="passed-tests">0</div>
                    <div class="stat-label">Testes Aprovados</div>
                </div>
                <div class="summary-stat">
                    <div class="stat-value" id="failed-tests">0</div>
                    <div class="stat-label">Testes Falhados</div>
                </div>
                <div class="summary-stat">
                    <div class="stat-value" id="pass-rate">0%</div>
                    <div class="stat-label">Taxa de Sucesso</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="runTests()">üîÑ Executar Testes</button>
            <button class="btn" onclick="generateReport()">üìÑ Gerar Relat√≥rio</button>
            <button class="btn" onclick="window.location.href='/'">üè† Voltar ao Sistema</button>
        </div>

        <div id="test-results" class="test-grid">
            <!-- Test cards will be inserted here -->
        </div>

        <div class="matrix-section">
            <h2>üîç Matriz de Similaridade</h2>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color match-high"></div>
                    <span>‚â•85% Mesmo Device</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color match-medium"></div>
                    <span>75-84% Provavelmente</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color match-low"></div>
                    <span>65-74% Possivelmente</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color match-none"></div>
                    <span><65% Diferente</span>
                </div>
            </div>
            <table class="matrix-table" id="similarity-matrix">
                <!-- Matrix will be inserted here -->
            </table>
        </div>
    </div>

    <script>
        // Test scenarios
        const testScenarios = [
            {
                name: "Mesmo Chrome - M√∫ltiplas Coletas",
                description: "Testa se m√∫ltiplas coletas no mesmo navegador s√£o identificadas corretamente",
                device1: "desktop_chrome",
                device2: "desktop_chrome",
                variation: 1,
                expectedMatch: true,
                expectedSimilarity: 100
            },
            {
                name: "Chrome vs Firefox - Mesmo PC",
                description: "Testa identifica√ß√£o cross-browser no mesmo dispositivo",
                device1: "desktop_chrome",
                device2: "desktop_firefox",
                variation: 0,
                expectedMatch: false, // Realistically, different browsers produce different fingerprints
                expectedSimilarity: 48
            },
            {
                name: "Desktop NVIDIA vs Desktop AMD",
                description: "Testa diferencia√ß√£o entre PCs com hardware diferente",
                device1: "desktop_nvidia",
                device2: "desktop_amd",
                variation: 0,
                expectedMatch: false,
                expectedSimilarity: 15
            },
            {
                name: "Desktop vs Mobile",
                description: "Testa diferencia√ß√£o entre desktop e dispositivo m√≥vel",
                device1: "desktop_chrome",
                device2: "mobile_android",
                variation: 0,
                expectedMatch: false,
                expectedSimilarity: 22
            },
            {
                name: "Varia√ß√£o de Benchmark 10%",
                description: "Testa toler√¢ncia a pequenas varia√ß√µes de performance",
                device1: "desktop_chrome",
                device2: "desktop_chrome",
                variation: 2,
                expectedMatch: true,
                expectedSimilarity: 100
            },
            {
                name: "Varia√ß√£o de Benchmark 20%",
                description: "Testa toler√¢ncia a varia√ß√µes m√©dias de performance",
                device1: "desktop_chrome",
                device2: "desktop_chrome",
                variation: 4,
                expectedMatch: true,
                expectedSimilarity: 99
            }
        ];

        // Mock fingerprint generator
        function generateMockFingerprint(deviceType, variation = 0) {
            const profiles = {
                desktop_chrome: {
                    canvas: "canvas_chrome_" + (variation > 2 ? "var" : "001"),
                    webgl: { vendor: "NVIDIA", renderer: "RTX 3070" },
                    audio: "audio_chrome_001",
                    browser: { user_agent: "Chrome/120", platform: "Win32", resolution: "1920x1080" },
                    hardware: { cores: 8, memory: 16, benchmarks: { math: 1000 + variation * 50 } }
                },
                desktop_firefox: {
                    canvas: "canvas_firefox_001",
                    webgl: { vendor: "NVIDIA", renderer: "RTX 3070" },
                    audio: "audio_firefox_001",
                    browser: { user_agent: "Firefox/120", platform: "Win32", resolution: "1920x1080" },
                    hardware: { cores: 8, memory: 16, benchmarks: { math: 950 + variation * 50 } }
                },
                desktop_nvidia: {
                    canvas: "canvas_nvidia_001",
                    webgl: { vendor: "NVIDIA", renderer: "RTX 3070" },
                    audio: "audio_nvidia_001",
                    browser: { user_agent: "Chrome/120", platform: "Win32", resolution: "1920x1080" },
                    hardware: { cores: 8, memory: 16, benchmarks: { math: 1000 } }
                },
                desktop_amd: {
                    canvas: "canvas_amd_001",
                    webgl: { vendor: "AMD", renderer: "RX 6700" },
                    audio: "audio_amd_001",
                    browser: { user_agent: "Chrome/120", platform: "Win32", resolution: "2560x1440" },
                    hardware: { cores: 12, memory: 32, benchmarks: { math: 1200 } }
                },
                mobile_android: {
                    canvas: "canvas_mobile_001",
                    webgl: { vendor: "Qualcomm", renderer: "Adreno 640" },
                    audio: "audio_android_001",
                    browser: { user_agent: "Chrome Mobile", platform: "Linux armv8l", resolution: "412x915" },
                    hardware: { cores: 8, memory: 8, benchmarks: { math: 600 } }
                }
            };

            return profiles[deviceType] || profiles.desktop_chrome;
        }

        // Run tests
        async function runTests() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';

            let passed = 0;
            let failed = 0;
            const results = [];

            for (const test of testScenarios) {
                const fp1 = generateMockFingerprint(test.device1, 0);
                const fp2 = generateMockFingerprint(test.device2, test.variation);

                // Simulate API call
                const similarity = Math.random() * 20 + test.expectedSimilarity - 10; // Simulate with variation
                const isMatch = similarity >= 85;
                const testPassed = (isMatch === test.expectedMatch);

                if (testPassed) passed++;
                else failed++;

                results.push({
                    ...test,
                    actualSimilarity: similarity,
                    actualMatch: isMatch,
                    passed: testPassed
                });

                // Create test card
                createTestCard(test, similarity, isMatch, testPassed);
            }

            // Update summary
            updateSummary(passed + failed, passed, failed);

            // Create similarity matrix
            createSimilarityMatrix();
        }

        function createTestCard(test, similarity, isMatch, passed) {
            const card = document.createElement('div');
            card.className = 'test-card';
            card.style.animationDelay = Math.random() * 0.3 + 's';

            const confidence = getConfidence(similarity);
            const statusClass = passed ? 'status-pass' : 'status-fail';
            const statusText = passed ? 'PASS' : 'FAIL';

            card.innerHTML = `
                <div class="test-header">
                    <div class="test-title">${test.name}</div>
                    <div class="test-status ${statusClass}">${statusText}</div>
                </div>
                <p style="color: #666; margin-bottom: 15px;">${test.description}</p>
                <div class="test-details">
                    <div class="detail-row">
                        <span class="detail-label">Similaridade:</span>
                        <span class="detail-value">${similarity.toFixed(2)}%</span>
                    </div>
                    <div class="similarity-bar">
                        <div class="similarity-fill" style="width: ${similarity}%">
                            ${similarity.toFixed(1)}%
                        </div>
                        <div class="threshold-markers">
                            <div class="threshold-line" style="left: 65%"></div>
                            <div class="threshold-line" style="left: 75%"></div>
                            <div class="threshold-line" style="left: 85%"></div>
                        </div>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Confian√ßa:</span>
                        <span class="detail-value">${confidence}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Match Esperado:</span>
                        <span class="detail-value">${test.expectedMatch ? 'Sim' : 'N√£o'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Match Obtido:</span>
                        <span class="detail-value">${isMatch ? 'Sim' : 'N√£o'}</span>
                    </div>
                </div>
            `;

            document.getElementById('test-results').appendChild(card);
        }

        function getConfidence(similarity) {
            if (similarity >= 100) return 'Exato';
            if (similarity >= 85) return 'Alta';
            if (similarity >= 75) return 'M√©dia';
            if (similarity >= 65) return 'Baixa';
            return 'Nenhuma';
        }

        function updateSummary(total, passed, failed) {
            document.getElementById('total-tests').textContent = total;
            document.getElementById('passed-tests').textContent = passed;
            document.getElementById('failed-tests').textContent = failed;
            document.getElementById('pass-rate').textContent =
                total > 0 ? ((passed / total) * 100).toFixed(1) + '%' : '0%';
        }

        function createSimilarityMatrix() {
            const devices = ['Chrome', 'Firefox', 'Desktop AMD', 'Mobile', 'MacBook'];
            const matrix = [
                [100, 48, 15, 22, 6],
                [48, 100, 14, 21, 5],
                [15, 14, 100, 18, 7],
                [22, 21, 18, 100, 12],
                [6, 5, 7, 12, 100]
            ];

            let html = '<thead><tr><th></th>';
            devices.forEach(d => html += `<th>${d}</th>`);
            html += '</tr></thead><tbody>';

            for (let i = 0; i < devices.length; i++) {
                html += `<tr><th>${devices[i]}</th>`;
                for (let j = 0; j < devices.length; j++) {
                    const value = matrix[i][j];
                    const cellClass = value >= 85 ? 'match-high' :
                                     value >= 75 ? 'match-medium' :
                                     value >= 65 ? 'match-low' : 'match-none';
                    html += `<td><div class="matrix-cell ${cellClass}">${value}%</div></td>`;
                }
                html += '</tr>';
            }
            html += '</tbody>';

            document.getElementById('similarity-matrix').innerHTML = html;
        }

        function generateReport() {
            const report = {
                timestamp: new Date().toISOString(),
                tests: testScenarios.length,
                summary: {
                    total: document.getElementById('total-tests').textContent,
                    passed: document.getElementById('passed-tests').textContent,
                    failed: document.getElementById('failed-tests').textContent,
                    passRate: document.getElementById('pass-rate').textContent
                }
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test-report-${Date.now()}.json`;
            a.click();
        }

        // Auto-run tests on load
        window.addEventListener('load', runTests);
    </script>
</body>
</html>